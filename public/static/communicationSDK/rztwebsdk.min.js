function WEBSDKINIT(){var e={websdk:function(e,t,n,o,a){if(arguments.length<=0)return this.websdk.prototype.socket=this.socket,this.websdk.prototype.ajax=this.ajax,void(this.websdk.prototype.event=this.event);if(this.event.accountInfo={account:e,password:t,serviceUrl:n,socketUrl:o,sipUrl:a},this.sip=null,"function"==typeof this.socket){this.socket(e,t,o);let u=this;u.event.ws.onRspMsg=function(o){"rsp_msg"!=o.cmd||o.data.userinfo.account!=u.event.accountInfo.account||1!=o.data.userinfo.scope&&2!=o.data.userinfo.scope||(u.event.getConfig(u.event.accountInfo,function(n){if(0==n.res_code){u.event.config=n.data;let e=null,t=null;t=u.event.accountInfo.sipUrl&&""!=u.event.accountInfo.sipUrl?(e=[u.event.accountInfo.sipUrl.split(":")[1].slice(2)],u.event.accountInfo.sipUrl.split(":")[2]):(e=n.data.webrtc_url.match(/(\d{1,3}\.){3}\d{1,3}/g),n.data.webrtc_url.split(":")[2]),function e(t,n,o,a,s,i){if(window.RZTRtcSDK){let e=u.event.accountInfo.sipUrl&&""!=u.event.accountInfo.sipUrl?u.event.accountInfo.sipUrl:s;u.sip=new window.RZTRtcSDK.RTCSDK(t,n,o,a,""),u.sip.enableDebug(),u.sip.setParams({ringRingUrl:"ringtone.wav",rztpcc:!0,sessionExpires:240,width:640,height:360,frameRate:30,bandWidth:800,screenWidth:1280,screenHeight:720,screenFrameRate:20,screenBandWidth:1200,pcc:{iceServers:[{urls:[`turn:${e.replace(/(\w+:\/\/)|(:[\s\S]+)/g,"")}:${i||"3478"}`],username:"RztRds2020",credential:"123456_RztRds_654321"}],iceTransportPolicy:"relay",rtcpMuxPolicy:"require"},ringBackUrl:"ringback.wav"}),u.sip.eventHandler=function(e,t){var{remoteUser:n,callType:o,statusCode:a}=t,{originator:s,cause:i}=t,{type:d,reason:c}=t;let r="",l="",m="";switch(u.event.rtcsdk.eventHandler(e,t),e){case"registered":console.log(123),r="注册成功",u.event.rtcsdk.registered(e,r);break;case"incomingCall":r="您有一个来自"+n+"的"+("video"===o?"视频":"语音")+"通话，请接听！",u.event.rtcsdk.incomingCall(e,t,r);break;case"remoteRingRing":r=("video"===o?"视频":"语音")+"呼叫"+n+"中，对方"+a+"正在振铃。。。",u.event.rtcsdk.remoteRingRing(e,t,r);break;case"remoteAnswerCall":r=n+"已接通与您的"+("video"===o?"视频":"语音")+"通话。","camera"===u.sip.getVideoSource()||u.sip.getVideoSource(),u.event.rtcsdk.remoteAnswerCall(e,t,r);break;case"remoteHangupCall":r=n+"已挂断与您的"+("video"===o?"视频":"语音")+"通话。",u.event.rtcsdk.remoteHangupCall(e,t,r);break;case"localAnswerCall":r="您已接通与"+n+"的"+("video"===o?"视频":"语音")+"通话。","camera"===u.sip.getVideoSource()||u.sip.getVideoSource(),u.event.rtcsdk.localAnswerCall(e,t,r);break;case"localHangupCall":r="您已挂断与"+n+"的"+("video"===o?"视频":"语音")+"通话。",u.event.rtcsdk.localHangupCall(e,t,r);break;case"videoSourceChanged":"camera"===u.sip.getVideoSource()||u.sip.getVideoSource(),u.event.rtcsdk.videoSourceChanged(e,t);break;case"callEstablishFailed":r="呼叫建立失败，失败方为："+s+"，失败原因为："+i+"。",u.event.rtcsdk.callEstablishFailed(e,t,r);break;case"missCall":l="您有一个来自"+n+"的"+("video"===o?"视频":"语音")+"通话，由于线路繁忙已被挂断。",u.event.rtcsdk.missCall(e,t,l);break;case"failed":l="有错误发生，错误类型："+d+"，错误原因："+c+"。","accountError"==d?l+="账号的用户名或密码错误，请联系管理员！":"connectionError"==d&&(l+="连接服务器错误，请联系管理员！"),u.event.rtcsdk.failed(e,t,l);break;case"secondCall":m="您有一个来自"+n+"的"+("video"===o?"视频":"语音")+"通话，请接听！（第二路）",u.event.rtcsdk.secondCall(e,t,m);break;case"remoteSecondCallHangup":m=n+"已挂断与您的"+("video"===o?"视频":"语音")+"通话。（第二路）",u.event.rtcsdk.remoteSecondCallHangup(e,t,m);break;case"localSecondCallHangup":m="您已挂断与"+n+"的"+("video"===o?"视频":"语音")+"通话。（第二路）",u.event.rtcsdk.localSecondCallHangup(e,t,m);break;case"secondCallEstablishFailed":m="呼叫建立失败，失败方为："+s+"，失败原因为："+i+"。（第二路）",u.event.rtcsdk.secondCallEstablishFailed(e,t,m)}},u.event.accountInfo.sipUrl&&""!=u.event.accountInfo.sipUrl&&u.sip.setWebSocketInfo(u.event.accountInfo.sipUrl),u.sip.start(),window.WEBSDK.event.rtcsdk.UA=u.sip}else e()}(o.data.userinfo.phorex,u.event.accountInfo.password,e[0],t,n.data.webrtc_url,n.data.turn_port)}}.bind(u)),setTimeout(function(){u.event.user.getUserList()}.bind(u),0))}}},ajax:function(e){let t=e||{},m=new(window.XMLHttpRequest?XMLHttpRequest:ActiveXObject),u=t.method.toLocaleLowerCase()||"get",h=t.url,w=t.data||{},f=t.async||!0,g=t.type||"",v=t.timeout||"30000";return new Promise((e,t)=>{m.ontimeout=()=>t("请求超时");let n=[],o;if("get"===u||"delete"===u){if(w instanceof Object){for(var a in w)n.push(encodeURIComponent(a)+"="+encodeURIComponent(w[a]));o=n.join("&")}var s=h.indexOf("?");-1===s?h+="?":s!==h.length-1&&(h+="&"),h+=o}if(m.open(u,h,f),"get"===u)m.send(null);else if("post"==u||"put"==u){switch(o=w||{},g){case"file":const i=new FormData;Object.keys(o).forEach(e=>{o[e]&&i.append(e,o[e])}),o=i;break;case"json":const d=o||{},c={};Object.keys(d).forEach(e=>{d[e]&&(c[e]=d[e])}),o=JSON.stringify(c),m.setRequestHeader("Content-Type","application/json; charset=utf-8");break;default:const r=o||{},l=new URLSearchParams;Object.keys(r).forEach(e=>{r[e]&&l.append(e,r[e])}),o=l,m.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}m.send(o)}else"delete"==u&&m.send(null);m.onreadystatechange=function(){4==m.readyState&&(200<=m.status&&m.status<=300||304==m.status?e&&e(JSON.parse(m.responseText)):t&&t({code:"-2",msg:"接口异常"}))},m.onerror=e=>t&&t(e),setTimeout(function(){4!=m.readyState&&(m.abort(),t&&t("请求超时"))},v)})},socket:function(){let o={ws:null,timers:null,timeoutFn:null,timeoutFlag:!0},a={onMessage:function(e){switch(e.cmd){case"error":this.event.ws.onMsgError(e);break;case"alarm":this.event.ws.onAlarm(e);break;case"rsp_msg":this.event.ws.onRspMsg(e);break;case"im_msg":this.event.ws.onIm(e);break;case"extension_state_notice":this.event.socket.wsDataMethod.extensionStatusNotice(e.data),this.event.socket.wsDataMethod.userOnMeetin(e.data),this.event.ws.onState(e);break;case"queue_monitor_notice":this.event.ws.onQueueMonitorNotice(e);break;case"extension_status_notice":this.event.socket.wsDataMethod.extensionStatusNotice(e.data),this.event.ws.onStatus(e);break;case"login":this.event.ws.onLogin(e);break;case"logout":this.event.ws.onLogout(e);break;case"video_linkage_ring":this.event.ws.onVideoLinkageRing(e);break;case"video_linkage_answer":this.event.ws.onVideoLinkageAnswer(e);break;case"video_linkage_hangup":this.event.ws.onVideoLinkageHangup(e);break;case"guiji":var t={users:[e.data]};this.event.socket.wsDataMethod.guijiNotice(t),this.event.ws.onGuiji(e);break;case"meetin":e.changeInfo=this.event.socket.wsDataMethod.userOnMeetin(e.data,!0),this.event.ws.onMeetin(e);break;case"meetout":e.changeInfo=this.event.socket.wsDataMethod.userOnMeetin(e.data,!1),this.event.ws.onMeetout(e);break;case"meetoff":this.event.socket.wsDataMethod.meetoffMethod(e.data),this.event.ws.onMeetoff(e);break;case"meetkick":this.event.socket.wsDataMethod.meetdeleteMethod(e.data),this.event.ws.onMeetkick(e);break;case"meetmute":this.event.socket.wsDataMethod.meetstateMethod(e.data,{mute:!0}),this.event.ws.onMeetmute(e);break;case"meetunmute":this.event.socket.wsDataMethod.meetstateMethod(e.data,{mute:!1}),this.event.ws.onMeetunmute(e);break;case"meetvmute":this.event.socket.wsDataMethod.meetstateMethod(e.data,{vmute:!0}),this.event.ws.onMeetvmute(e);break;case"meetunvmute":this.event.socket.wsDataMethod.meetstateMethod(e.data,{vmute:!1}),this.event.ws.onMeetunvmute(e);break;case"meetvblind":this.event.socket.wsDataMethod.meetstateMethod(e.data,{vblind:!0}),this.event.ws.onMeetvblind(e);break;case"meetunvblind":this.event.socket.wsDataMethod.meetstateMethod(e.data,{vblind:!1}),this.event.ws.onMeetunvblind(e);break;case"meetadd":this.event.socket.wsDataMethod.meetaddMethod(e.data),this.event.ws.onMeetadd(e);break;case"meetdeaf":this.event.socket.wsDataMethod.meetstateMethod(e.data,{deaf:!0}),this.event.ws.onMeetdeaf(e);break;case"meetundeaf":this.event.socket.wsDataMethod.meetstateMethod(e.data,{deaf:!1}),this.event.ws.onMeetundeaf(e);break;case"meet_member_start_talk":if(this.event.ws.onMeetMemberStartTalk(e),3===this.event.meet.meetInfo.type)return;this.event.socket.wsDataMethod.meetstateMethod(e.data,{speak:!0});break;case"meet_member_stop_talk":if(this.event.ws.onMeetMemberStopTalk(e),3===this.event.meet.meetInfo.type)return;this.event.socket.wsDataMethod.meetstateMethod(e.data,{speak:!1});break;case"channel_release":t={users:[e.data.channel_holder],meetmun:e.data.channel_id};e.changeInfo=this.event.socket.wsDataMethod.meetstateMethod(t,{speak:!1}),this.event.ws.onChannelRelease(e);break;case"channel_get":var n={users:[e.data.channel_holder],meetmun:e.data.channel_id};e.changeInfo=this.event.socket.wsDataMethod.meetstateMethod(n,{speak:!0}),this.event.ws.onChannelGet(e);break;case"channel_add_user":n={meetnum:e.data.channel_id,users:e.data.users};this.event.socket.wsDataMethod.meetaddMethod(n),this.event.ws.onChannelAddUser(e);break;case"channel_del_user":var o={meetnum:e.data.channel_id,users:e.data.users};this.event.socket.wsDataMethod.deleteMeetingUser(o),this.event.ws.onChannelDelUser(e);break;case"channel_in":this.event.ws.onChannelIn(e);break;case"channel_out":this.event.ws.onChannelOut(e);break;case"channel_hangup":o={meetnum:e.data.channel_id};this.event.socket.wsDataMethod.channelHangupMethod(o),this.event.ws.onChannelHangup(e);break;case"meet_play_file_start":this.event.socket.wsDataMethod.changeTaskStartMethod(e.data),this.event.ws.onMeetPlayFileStart(e);break;case"meet_play_file_stopped":this.event.socket.wsDataMethod.changeTaskStopMethod(e.data),this.event.ws.onMeetPlayFileStopped(e)}}.bind(this),onClose:function(e){this.event.ws.onClose(e)}.bind(this),onError:function(e){this.event.ws.onError(e)}.bind(this),onSend:function(){this.event.socket.send=new d}.bind(this)};if(arguments.length<3)return;var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";let s={};const i=e=>{delete s[e]};function d(){this.socketSend=function(e,t){const n=e;n.msgid=n.cmd+ +new Date,s[n.msgid]=t,o.ws&&1==o.ws.readyState&&o.ws.send(JSON.stringify(n))}}function c(){o.timers=setInterval(function(){const e={cmd:"heart",msgid:"heart"};e.data={createtime:+new Date,id:this.WEBSDK.event.oneSelf.id,lng:"",lat:"",battery:"",speed:"",direction:"",channel_online:!1};var t=JSON.stringify(e);o.timeoutFlag&&(clearTimeout(o.timeoutFn),t=t,o.ws&&1==o.ws.readyState&&o.ws.send(t),o.timeoutFlag=!1)}.bind(this),15e3)}let r=function(e){this.event.oneSelf=e}.bind(this);o.ws=new WebSocket(n),o.ws.onopen=function(){o.ws.send(JSON.stringify({cmd:"login",data:{account:e,password:t}})),c()},o.ws.onmessage=function(e){e=JSON.parse(e.data);if(window.WEBSDK.event.ws.onMessage(e),e.msgid&&"heart"!==e.msgid&&0==parseInt(e.res_code)){const n=s[e.msgid];n(e),i(e.msgid)}let t={};return e.msgid&&"heart"==e.msgid&&(o.timeoutFlag=!0,o.timeoutFn=setTimeout(()=>{clearInterval(o.timers),c()},1e4)),"b0001"===e.res_code?(t={res_code:"b0001",res_msg:"用户名不存在"},a.onMessage({cmd:"error",data:t}),!1):"b0003"===e.res_code?(t={res_code:"b0003",res_msg:"用户名或密码不正确"},a.onMessage({cmd:"error",data:t}),!1):"b0005"===e.res_code?(t={res_code:"b0005",res_msg:"登录超时，请重新操作"},a.onMessage({cmd:"error",data:t}),!1):void(e.res_code&&0===parseInt(e.res_code)&&!e.msgid?(r(e.data.userinfo),sessionStorage.setItem("user",JSON.stringify(e.data.userinfo)),a.onMessage(e)):e.res_code||a.onMessage(e))},o.ws.onclose=function(e){clearInterval(o.timers),a.onClose(e),o.ws},o.ws.onerror=function(e){a.onError(e)},this.event.ws.websocket=o.ws,a.onSend()},codeMsg:{},event:{accountInfo:{},ws:{onMessage:function(){},onClose:function(){},onError:function(){},onMsgError:function(){},onState:function(){},onStatus:function(){},onAlarm:function(){},onRspMsg:function(){},onIm:function(){},onQueueMonitorNotice:function(){},onLogin:function(){},onLogout:function(){},onVideoLinkageRing:function(){},onVideoLinkageAnswer:function(){},onVideoLinkageHangup:function(){},onGuiji:function(){},onMeetin:function(){},onMeetout:function(){},onMeetoff:function(){},onMeetkick:function(){},onMeetmute:function(){},onMeetunmute:function(){},onMeetadd:function(){},onMeetdeaf:function(){},onMeetundeaf:function(){},onMeetMemberStartTalk:function(){},onMeetMemberStopTalk:function(){},onChannelRelease:function(){},onChannelGet:function(){},onChannelAddUser:function(){},onChannelDelUser:function(){},onChannelIn:function(){},onChannelOut:function(){},onChannelHangup:function(){},onMeetPlayFileStart:function(){},onMeetPlayFileStopped:function(){},onMeetvmute:function(){},onMeetunvmute:function(){},onMeetvblind:function(){},onMeetunvblind:function(){}},oneSelf:{},config:{},getConfig:function(e,t){this.WEBSDK.ajax({url:e.serviceUrl+"/dispatch/api?cmd=config",method:"get"}).then(e=>{t&&t(e)})}.bind(this),user:{},monitor:{},IM:{},rtcsdk:{UA:{},eventHandler:function(){},registered:function(){},incomingCall:function(){},remoteRingRing:function(){},remoteAnswerCall:function(){},remoteHangupCall:function(){},localAnswerCall:function(){},localHangupCall:function(){},videoSourceChanged:function(){},callEstablishFailed:function(){},missCall:function(){},failed:function(){},secondCall:function(){},remoteSecondCallHangup:function(){},localSecondCallHangup:function(){},secondCallEstablishFailed:function(){}},JsSip:{},meet:{},socket:{send:{},wsDataMethod:{}},base:{},callRecords:{}},version:"1.0.0.13"};e.websdk(),"undefined"!=typeof window&&(window.WEBSDK=e)}!function(){function e(){const s={linkage:{url:"/dispatch/linkagephone"},distribute:{url:"/dispatch/api?cmd=im_dispatch_init&"}};this.mediaRecoderInfo=null;let d=[],l={};const m=(e,t)=>{var n=document.createElement("a");n.style.display="none",n.download=t?t+"_"+(new Date).getTime():(new Date).getTime(),n.href=e,document.body.appendChild(n),n.click(),n.remove()},c=e=>{"function"==typeof l.handleDataFun?l.handleDataFun(e):(e=e)&&e.data&&0<e.data.size&&d.push(e.data)},r=e=>{var t;new Blob(d,{type:l.blobType});"function"==typeof l.stopFun?l.stopFun(d):(t=new Blob(d,{type:l.blobType}),t=window.URL.createObjectURL(t),m(t)),l.mediaRecoder.removeEventListener("dataavailable",c),l.mediaRecoder.removeEventListener("stop",r),l.mediaStream=null,l={}};return this.getUserStearm=e=>new Promise((t,n)=>{window.navigator.mediaDevices.getUserMedia(e).then(e=>{t(e)}).catch(e=>{n(e)})}),this.stopRecord=(e,t)=>{e.stop(),this.mediaRecoderInfo=null,"IM"==t&&e.stream.getTracks().forEach(e=>e.stop())},this.startRecord=(e,{handleDataFun:t,stopFun:n,blobType:o="video/mp4",mimeType:a="video/webm;codecs=vp8",start:s=10})=>{var i={mimeType:a},a="";if(MediaRecorder.isTypeSupported(i.mimeType)){d=[];try{a=new MediaRecorder(e,i),l={mediaStream:e,handleDataFun:t,stopFun:n,blobType:o,mediaRecoder:a},a.addEventListener("dataavailable",c),a.addEventListener("stop",r),a.start(s),this.mediaRecoderInfo=a}catch(e){console.log("创建MediaRecorder失败!")}return a}console.log(`不支持${i.mimeType}`)},this.videoPhotograph=(e,t,{phoneX:n},{handleDataFun:o,stopFun:a,blobType:s="video/mp4",mimeType:i="video/webm;codecs=vp8"})=>{var d,c,r={mimeType:i},i="";if(MediaRecorder.isTypeSupported(r.mimeType)){try{i=new MediaRecorder(e,r),l={mediaStream:e,handleDataFun:o,stopFun:a,blobType:s,mediaRecoder:i},1==l.mediaStream.getTracks().length?(d=l.mediaStream.getTracks()[0].getSettings().width,c=l.mediaStream.getTracks()[0].getSettings().height):2==l.mediaStream.getTracks().length&&(d=l.mediaStream.getTracks()[1].getSettings().width,c=l.mediaStream.getTracks()[1].getSettings().height)}catch(e){console.log("创建MediaRecorder失败!")}s=([{width:a,height:s}]=[{width:d,height:c}],(i=document.createElement("canvas")).width=a,i.height=s,i.style.display="none",document.body.appendChild(i),i),i="";s.getContext("2d").drawImage(t,0,0,d,c),i=s.toDataURL("image/png"),m(i,n),s.remove()}else console.log(`不支持${r.mimeType}`)},this.videoDistribute=function(n,o,e,a){o.infos="视频单呼"===n?{phorex:o.other.phorex,id:o.other.id,name:o.other.name}:{name:o.name,rtmpUrl:o.rtmpUrl,webRtcUrl:o.webRtcUrl};var t=window.WEBSDK.event.oneSelf.id;window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.distribute.url+`userid=${t}`,method:"get"}).then(t=>{console.log(t),source=0==t.code?(e.forEach(function(e){e={content:t.data.mine.username+"邀请您查看"+o.name+"的视频",sender:t.data.mine.id,sender_name:t.data.mine.username,receiver:e.id,receiver_name:e.name,content_type:`${"视频单呼"===n?"6":"7"}`,isGroup:"0",isTarget:o.infos};window.WEBSDK.event.socket.send.socketSend({cmd:"im_msg",data:e},function(e){})}),{data:t.data,code:"0",msg:"请求成功"}):{code:"a0001",msg:t.res_msg},a&&a(source)})},this.getConfig=function(e){e&&e(window.WEBSDK.event.config)},this.userEdit=function(e,n){window.WEBSDK.event.socket&&window.WEBSDK.event.socket.send.socketSend?window.WEBSDK.event.socket.send.socketSend({cmd:"useredit",data:e},function(e){let t;t=0==e.res_code?{data:e.data,code:"0",msg:"请求成功"}:{code:"-1",msg:"请求失败"},n&&n(t)}):n&&n({code:"c0004",msg:"登录超时，请重新登录"})},this.getLinkage=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.linkage.url+"?userId="+e.userId,method:"get"}).then(e=>{let t={};t=1==e.code?{code:"0",data:e.data,msg:"请求成功"}:{code:"-1",msg:"请求失败"},n&&n(t)})},this.setLinkage=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.linkage.url,method:"post",data:e}).then(e=>{let t={};t=1==e.code?{code:"0",msg:"请求成功",data:e.data}:{code:"-1",msg:"请求失败"},n&&n(t)})},this}this.WEBSDK||WEBSDKINIT(),this.WEBSDK&&(this.WEBSDK.event.base=new e)}(),function(){this.WEBSDK||WEBSDKINIT(),this.WEBSDK&&(this.WEBSDK.event.callRecords=new function(){let o={callUrl:"/cti/cpi?cmd=call_internal",meetUrl:"/cti/cpi?cmd=call_meet"};return this.getCallList=function(e,n){let t={seeall:window.WEBSDK.event.oneSelf?window.WEBSDK.event.oneSelf.seeall:"",phorex:window.WEBSDK.event.oneSelf?window.WEBSDK.event.oneSelf.phorex:"",userId:window.WEBSDK.event.oneSelf?window.WEBSDK.event.oneSelf.id:""};switch(e.isType){case 1:t=Object.assign(t,{all:0},e);break;case 2:t=Object.assign(t,{all:0,callee:t.phorex,callAnswerTime:0},e);break;case 3:t=Object.assign(t,{all:1},e)}window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+o.callUrl,method:"post",data:t}).then(e=>{let t={};t=0==e.error_code?{code:0,msg:e.error_msg,data:e.data}:{code:0,msg:e.error_msg},n&&n(t)})},this.getMeetCallList=function(e,n){var t={seeall:window.WEBSDK.event.oneSelf?window.WEBSDK.event.oneSelf.seeall:"",userId:window.WEBSDK.event.oneSelf?window.WEBSDK.event.oneSelf.id:""},t=Object.assign(t,e);window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+o.meetUrl,method:"post",data:t}).then(e=>{let t={};t=0==e.error_code?{code:0,msg:e.error_msg,data:e.data}:{code:0,msg:e.error_msg},n&&n(t)})},this})}(),function(){function e(){const o={Img:{url:"/dispatch/layuiIm/uploadImg"},File:{url:"/dispatch/layuiIm/uploadFile"},init:{url:"/dispatch/api?cmd=im_dispatch_init"},member:{url:"/dispatch/api?cmd=im_getmember_id"},userInfo:{url:"/dispatch/api?cmd=userinfo"}};let t=null;this.voiceMessagekSrc="",this.initIM=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+o.init.url+`userid=${e}`,method:"get"}).then(e=>{let t={};t=0==e.code?{data:e.data,code:"0",msg:"请求成功"}:{code:"a0001",msg:e.msg},n&&n(t)})},this.uploadImg=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+o.Img.url,method:"post",data:e,type:"file"}).then(e=>{let t={};t=0==e.code?{data:e.data,code:"0",msg:"请求成功"}:{code:"a0001",msg:e.msg},n&&n(t)})},this.uploadFile=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+o.File.url,method:"post",data:e,type:"file"}).then(e=>{let t={};t=0==e.code?{data:e.data,code:"0",msg:"请求成功"}:{code:"a0001",msg:e.msg},n&&n(t)})},this.disbandGroup=function(e,t){window.WEBSDK.event.socket.send.socketSend({cmd:"im_group_delete",data:{group_id:e}},{loadIf:!0}).then(e=>{t&&t(e)})},this.sendMessage=function(e,t,n){t={content:e.message.val,sender:window.WEBSDK.event.oneSelf.id,sender_name:window.WEBSDK.event.oneSelf.name,receiver:e.to.id,receiver_name:e.to.name,content_type:e.message.type,sender_headimg:window.WEBSDK.event.oneSelf.headimg,is_group:t,duration:this.times};window.WEBSDK.event.socket.send.socketSend({cmd:"im_msg",data:t},function(e){n&&n(e)})},this.addMember=function(e,t){window.WEBSDK.event.socket.send.socketSend({cmd:"im_group_member_add",data:e},function(e){t&&t(e)})},this.getMember=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+o.member.url+`id=${e}`,method:"get"}).then(e=>{t&&t(e)})},this.createGroup=function(e,t){window.WEBSDK.event.socket.send.socketSend({cmd:"im_group_create",data:e},function(e){t&&t(e)})};this.startRecording=function(){t=null,window.WEBSDK.event.base.getUserStearm({audio:!0}).then(e=>{t=startRecord(e,{stopFun:e=>{!function(e){e=new File(e,`${Date.now()}.mp3`,{type:"audio/mpeg"});return window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+o.File.url,method:"post",myFile:e,type:"file"}).then(e=>e.src)}(e).then(e=>{this.voiceMessagekSrc=e})},blobType:"audio/ogg; codecs=opus",mimeType:"audio/webm;codecs=opus"})})},this.stopRecording=function(){stopRecord(t,"IM"),t=null};function n(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+o.userInfo.url,method:"post",params:{orgid:orgid}}).then(n=>{var o={};"onLine"==e.status?Object.keys(n).forEach(e=>{var t=n[e];1!==parseInt(t.now_extension_status,10)&&(o[e]=t)}):o=n,t&&t(o)})}return this.voiceSingleCall=function(e,t){n(e,function(e){window.WEBSDK.event.JsSip.callAudio(e.phorex,function(e){t&&t(e)})})},this.videoSingleCall=function(e,t){n(e,function(e){window.WEBSDK.event.JsSip.callVideo(e.phorex,function(e){t&&t(e)})})},this.groupCall=function(e,t,n,o,a,s){},this}this.WEBSDK||WEBSDKINIT(),this.WEBSDK&&(this.WEBSDK.event.IM=new e)}(),function(){function e(){this.meetInfo={meetnum:"",meetMembers:[],type:null,state:!1,video:!1,radioFile:"beforePlay"};let i={meet:{meetinfoUrl:"/cti/cpi?cmd=meetinfo",meetonUrl:"/cti/cpi?cmd=meeton",meetMemberUsersUrl:"/dispatch/api?cmd=meet_member_users",meetoffUrl:"/cti/cpi?cmd=meetoff",meetCreateUrl:"/cti/cpi?cmd=meetcreate",meetDeleteUrl:"/cti/cpi?cmd=meetdelete",meetMuteUrl:"/cti/cpi?cmd=meetmute",meetUnmuteUrl:"/cti/cpi?cmd=meetunmute",meetDeafUrl:"/cti/cpi?cmd=meetdeaf",meetUndeafUrl:"/cti/cpi?cmd=meetundeaf",meetkickUrl:"/cti/cpi?cmd=meetkick",meetaddUrl:"/cti/cpi?cmd=meetadd",meetlayoutUrl:"/cti/cpi?cmd=meetlayout",meetlayerUrl:"/cti/cpi?cmd=meetlayer"},radio:{radioFileUrl:"/cti/file",radioTaskUrl:"/cti/fileBroadcast/assignment",MissTaskUrl:"/cti/meet/broadcast/assignment"}};this.allMeetList=[],this.allTalkList=[],this.allRadioList=[],this.allFiles=[],this.allradioTask=[];function d(e){let t={};return 0==e.error_code?(t={code:"0",msg:"请求成功"},e.data&&(t.data=e.data)):t={code:e.error_code,msg:e.error_msg},t}this.getMeetInfo=function(e){e&&e(this.meetInfo)},this.setMeetInfo=function(e){e=Object.assign(this.meetInfo,e);this.meetInfo=e,this.addEventMeetInfo(this.meetInfo)},this.addEventMeetInfo=function(e){},this.getMeetList=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetinfoUrl,method:"post",data:e}).then(e=>{0==e.error_code&&(this.allMeetList=e.data),t&&t(d(e))})},this.initMeeting=function(n,o){this.meetInfo.state?o&&o({msg:"目前已存在开启会议室，请挂断后再发起会议！"}):window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetonUrl,method:"post",data:n}).then(e=>{let t=Object.assign({state:!0,type:1,video:!1},n);t.video&&(t.type=2),t.assignment&&(t.type=4),this.setMeetInfo(t),0==e.error_code?this.getMeetMemberUsersList({meetnum:n.meetnum},function(e){o&&o(e)}):o&&o({code:e.error_code,msg:e.error_msg})})},this.getMeetMemberUsersList=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetMemberUsersUrl,method:"get",data:e}).then(e=>{let t={};0==e.res_code?(t={code:"0",msg:"请求成功"},e.data&&(t.data=e.data)):t={code:e.res_code,msg:e.res_msg},this.setMeetInfo({meetMembers:t.data}),n&&n(t)})},this.stopMeeting=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetoffUrl,method:"post",data:e}).then(e=>{this.setMeetInfo({meetnum:"",meetMembers:[],type:null,state:!1,video:!1,radioFile:"beforePlay"}),t&&t(d(e))})},this.createMeeting=function(e,n){let t={type:e.type||0,temp:e.temp||!0,meetname:e.meetname||"临时会议组",video:e.video||!1,members:[]},o=window.WEBSDK.event.oneSelf,a=window.WEBSDK.event.user.userList,s=o.phorex+"|"+o.dtype+"|false|false|"+o.gatewayname+",";e.meetMember.forEach((n,e)=>{a.forEach((e,t)=>{n==e.phorex&&o.phorex!=e.phorex&&(s+=e.phorex+"|"+e.dtype+"|false|false|"+e.gatewayname+",")})}),t.members=s,window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetCreateUrl,method:"get",data:t}).then(e=>{let t={};t=0==e.error_code?{code:"0",msg:"请求成功",data:{meetnum:e.meetnum}}:{code:"-1",msg:e.error_msg},n&&n(t)})},this.deleteMeeting=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetDeleteUrl,method:"get",data:e}).then(e=>{t&&t(d(e))})},this.addMeetmute=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetMuteUrl,method:"post",data:e}).then(e=>{t&&t(d(e))})},this.addMeetunmute=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetUnmuteUrl,method:"post",data:e}).then(e=>{t&&t(d(e))})},this.addMeetdeaf=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetDeafUrl,method:"post",data:e}).then(e=>{t&&t(d(e))})},this.addMeetundeaf=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetUndeafUrl,method:"post",data:e}).then(e=>{t&&t(d(e))})},this.addMeetkick=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetkickUrl,method:"post",data:e}).then(e=>{t&&t(d(e))})},this.addMettingMeetadd=function(s,n){let o={meetnum:s.meetnum,video:s.video,members:""};window.WEBSDK.event.user.getUserList({},function(e){let t=0==e.code?e.data:window.WEBSDK.event.user.userList,a="";s.meetMember.forEach((n,o)=>{t.forEach((e,t)=>{n==e.phorex&&(o+1==s.meetMember.length?a+=e.phorex+"|"+e.dtype+"|false|false|"+e.gatewayname:a+=e.phorex+"|"+e.dtype+"|false|false|"+e.gatewayname+",")})}),o.members=a,console.log(o),window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetaddUrl,method:"post",data:o}).then(e=>{n&&n(d(e))})})},this.addMeetlayout=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetlayoutUrl,method:"post",data:e}).then(e=>{t&&t(d(e))})},this.addMeetingVideoMeetlayer=function(e,t){setTimeout(()=>{window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetlayerUrl,method:"post",data:e}).then(e=>{t&&t(d(e))})},150)};function o(e){let t={};return t=0==e.res_code?{code:"0",msg:e.res_msg,data:e.data}:{code:e.res_msg,msg:e.res_msg},t}return this.getTalkList=function(t){let n=this;window.WEBSDK.event.socket.send.socketSend({cmd:"chnnel_history",data:{channel_type:"0"}},function(e){e=o(e);n.allTalkList=e.data||[],t&&t(e)})},this.talkInit=function({channel_id:e},s){if(this.meetInfo.state)s&&s({msg:"目前已存在一路通话或会议，请挂断后再进入对讲！"});else{let a={cmd:"channel_in",data:{channel_id:e}};window.WEBSDK.event.socket.send.socketSend(a,function(e){let t=this,n={},o;0==e.res_code?(n={code:"0",msg:e.res_msg,data:e.data},o={meetnum:e.data.channel_id,meetMembers:[],type:3,state:!0,video:!1,radioFile:"beforePlay"},t.setMeetInfo(o),t.talkMembers(e.data,function(e){0==e.code&&(n.data=Object.assign(n.data,{channel_members:e.data}),t.setMeetInfo({meetMembers:e.data})),s&&s(n)})):(n={code:e.res_msg,msg:e.res_msg},s&&s(n)),a,a}.bind(this))}},this.talkStop=function({channel_id:e},t){window.WEBSDK.event.socket.send.socketSend({cmd:"channel_out",data:{channel_id:e}},function(e){t&&t(o(e))})},this.talkMembers=function({channel_id:e},t){window.WEBSDK.event.socket.send.socketSend({cmd:"channel_members",data:{channel_id:e}},function(e){t&&t(o(e))})},this.talkChannelget=function({},t){var e={cmd:"channel_get",data:{channel_id:this.meetInfo.meetnum}};window.WEBSDK.event.socket.send.socketSend(e,function(e){t&&t(o(e))})},this.talkChannelrelease=function({},t){var e={cmd:"channel_release",data:{channel_id:this.meetInfo.meetnum}};window.WEBSDK.event.socket.send.socketSend(e,function(e){t&&t(o(e))})},this.talkchannelAddUser=function({meetnum:e,meetMember:t},n){t={cmd:"channel_add_user",data:{channel_id:e,id:t.join(",")}};window.WEBSDK.event.socket.send.socketSend(t,function(e){n&&n(o(e))})},this.getRadioList=function(e,t){e=Object.assign({type:1},e);window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.meet.meetinfoUrl,method:"post",data:e}).then(e=>{0==e.error_code&&(this.allRadioList=e.data),t&&t(d(e))})},this.getAllFile=function(e,n){var t={orgId:window.WEBSDK.event.oneSelf.orgid,userType:"dispatch"};Object.assign(t,e),console.log(t),window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.radioFileUrl,method:"get",data:t}).then(e=>{let t={};t=1==e.code?(e.data&&null!=e.data&&(this.allFiles=e.data.result),{code:0,data:e.data,msg:e.msg}):{code:e.code,msg:e.msg},n&&n(t)})},this.uploadFiles=function(e,n){e={orgId:window.WEBSDK.event.oneSelf.orgid,userType:"dispatch",file:e.file,userId:window.WEBSDK.event.oneSelf.id,alias:e.fileName};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.radioFileUrl,method:"post",data:e,type:"file"}).then(e=>{let t={};t=1==e.code?{code:0,data:e.data,msg:e.msg}:{code:e.code,msg:e.msg},n&&n(t)})},this.deleteFiles=function(e,n){e={orgId:window.WEBSDK.event.oneSelf.orgid,userType:"dispatch",fileIds:e.fileIds};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.radioFileUrl,method:"delete",data:e}).then(e=>{let t={};t=1==e.code?{code:0,data:e.data,msg:e.msg}:{code:e.code,msg:e.msg},n&&n(t)})},this.getAllRadioTask=function(e,n){var t={orgId:window.WEBSDK.event.oneSelf.orgid,userType:"dispatch"};Object.assign(t,e),window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.radioTaskUrl,method:"get",data:t}).then(e=>{let t={};t=1==e.code?(e.data&&null!=e.data&&(this.allradioTask=e.data.result),{code:0,data:e.data,msg:e.msg}):{code:e.code,msg:e.msg},n&&n(t)})},this.setRadioTask=function(e,n){e={name:e.name,orgId:window.WEBSDK.event.oneSelf.orgid,userId:window.WEBSDK.event.oneSelf.id,userType:"dispatch",times:e.times||1,files:e.files};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.radioTaskUrl,method:"post",data:e,type:"json"}).then(e=>{let t={};t=1==e.code?{code:0,data:e.data,msg:e.msg}:{code:e.code,msg:e.msg},n&&n(t)})},this.updataRadioTask=function(e,n){e={name:e.name,orgId:window.WEBSDK.event.oneSelf.orgid,userId:window.WEBSDK.event.oneSelf.id,userType:"dispatch",times:e.times||1,files:e.files,id:e.id};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.radioTaskUrl,method:"put",data:e,type:"json"}).then(e=>{let t={};t=1==e.code?{code:0,msg:e.msg}:{code:e.code,msg:e.msg},n&&n(t)})},this.deleteRadioTask=function(e,n){e={assignmentIds:e.assignmentIds,orgId:window.WEBSDK.event.oneSelf.orgid,userType:"dispatch",userId:window.WEBSDK.event.oneSelf.id};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.radioTaskUrl,method:"delete",data:e}).then(e=>{let t={};t=1==e.code?{code:0,msg:e.msg}:{code:e.code,msg:e.msg},n&&n(t)})},this.getRadioDefaultTask=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.MissTaskUrl,method:"get",data:e}).then(e=>{let t={};t=1==e.code?{code:0,data:e.data,msg:e.msg}:{code:"-1",msg:e.msg},n&&n(t)})},this.updataRadioDefaultTask=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+i.radio.MissTaskUrl,method:"put",data:e}).then(e=>{let t={};t=1==e.code?{code:0,msg:e.msg}:{code:"-1",msg:e.msg},n&&n(t)})},this}this.WEBSDK||WEBSDKINIT(),this.WEBSDK&&(this.WEBSDK.event.meet=new e)}(),function(){this.WEBSDK||WEBSDKINIT(),this.WEBSDK&&(this.WEBSDK.event.monitor=new function(){const s={orgFrameList:{url:"/dm/GBT28181/directory"},equipmentList:{url:"/dm/GBT28181"},VideoInfo:{url:"/api/stream/v1/start"},pullVideo:{url:"/rtc/v1/play/"},accessClose:{url:"/cti/esl/conference/stopStream"},pullStream:{url:"/dm/GBT28181/pullStream"},share:"/api/stream/v1/share",meetShare:"/dm/GBT28181/share",meetFileUrl:"/cti/cpi"};let r=[],l=[];return this.GBStreamListChange=function(e){},this.getOrgFrameList=function({id:e},n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.orgFrameList.url+`?parentDirectoryId=${e}`,method:"get"}).then(e=>{let t={};1==e.code?(t={data:e.data,code:"0",msg:"请求成功"},this.equipmentList=e.data):t={code:"a0001",msg:e.msg},n&&n(t)})},this.getEquipmentList=function({name:e,deviceId:t},n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.equipmentList.url+`?Name=${e}&DeviceId=${t}`,method:"get"}).then(e=>{let t={};t=1==e.code?{data:e.data,code:"0",msg:"请求成功"}:{code:"a0001",msg:e.msg},n&&n(t)})},this.getVideoInfo=function(d,c){var e={name:d.name,serial:d.serial,sessionId:String(Math.floor(4e4*Math.random()+1e4))};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.VideoInfo.url,method:"post",data:e,type:"json"}).then(a=>{let s={};if(0==a.code){let t,n={},o={};o.pc=new RTCPeerConnection,r.push(o);const i=this;o.pc.onaddstream=function(e){n.name=d.name,n.sessionId=a.sessionId,n.rtmpUrl=a["rtmp-path"]+a.streamId,n.webRtcUrl=a["webrtc-path"]+a.streamId,n.serial=a.streamId,n.tapeStop=!1,n.stream=e.stream,l.push(n),i.GBStreamListChange(l)},new Promise(function(t,n){o.pc.addTransceiver("audio",{direction:"recvonly"}),o.pc.addTransceiver("video",{direction:"recvonly"}),o.pc.createOffer().then(function(e){t(e)}).catch(function(e){n(e)})}).then(function(e){return o.pc.setLocalDescription(e).then(function(){return e})}).then(function(e){t={api:window.WEBSDK.event.accountInfo.serviceUrl+"/rtc/v1/play/",streamurl:a["webrtc-path"]+a.streamId,clientip:null,sdp:e.sdp,rtmpPath:a["rtmp-path"],sessionId:a.sessionId,streamId:a.streamId,webrtcPath:a["webrtc-path"],rtcInit:o};e={api:t.api,sdp:e.sdp,streamurl:t.streamurl};s={data:t,code:"0",msg:"请求成功"},i.pullVideoSurveillance(e,o,n,c)})}else s={code:"-1",msg:a.msg},c&&c(s)})},this.pullVideoSurveillance=function(e,n,o,a){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.pullVideo.url,method:"post",data:e,type:"json"}).then(e=>{let t={};if(0==e.code)return t={data:{info:o},code:"0",msg:"请求成功"},a&&a(t),n.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.sdp}));t={code:"a0001",msg:e.msg},a&&a(t)})},this.getGBTPlayList=function(e){e&&e(l)},this.videoClose=function(n,e){l.forEach((e,t)=>{n.sessionId==e.sessionId&&(r[t].pc.close(),r.splice(t,1),l.splice(t,1),this.GBStreamListChange(l))}),e&&e({code:"0",msg:"挂断成功！"})},this.accessMonitoFn=function(t,o){var e={name:t.name,serial:t.serial,sessionId:String(Math.floor(4e4*Math.random()+1e4)),isFS:"yes"};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.VideoInfo.url,method:"post",data:e,type:"json"}).then(e=>{if(0==e.code){let n={meetNumber:t.meetNumber,streamURL:e["rtmp-path"]+e.streamId};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.pullStream.url,method:"post",data:n}).then(e=>{let t={};t=1==e.code?{code:"0",msg:"请求成功",data:{url:n.streamURL}}:{code:"-1",msg:e.msg},o&&o(t)})}else o&&o({code:"-1",msg:"拉流失败，请联系管理员！"})})},this.streamStopFn=function({meetNumber:e,streamURL:t},n){t={meetNumber:e,streamURL:t};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.accessClose.url,method:"post",data:t}).then(e=>{let t={};t=1==e.code?{code:"0",msg:"请求成功"}:{code:"-1",msg:e.msg},n&&n(t)})},this.streamShare=function(e,n){e={sessionId:String(Math.floor(4e4*Math.random()+1e4)),streamId:e.streamId};window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.share,method:"post",data:e,type:"json"}).then(e=>{let t={};t=0==e.code?{code:"0",data:{shareUrl:e["html-path"]+e.streamId},msg:"请求成功"}:{code:"-1",msg:e.msg},n&&n(t)})},this.videoMeetShare=function(e,n){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.meetShare,method:"get",data:e}).then(e=>{let t={};t=1==e.code?{code:"0",data:{shareUrl:e.data},msg:"请求成功"}:{code:"-1",msg:e.msg},n&&n(t)})},this.getStreamList=function(e,t){window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+s.meetFileUrl,method:"get",data:{meetnum:e.meetNumber,cmd:"meetfilelist"}}).then(e=>{0==e.error_code?t&&t({code:"0",msg:"请求成功",data:e.fileList}):t&&t({code:"-1",msg:e.error_msg})})},this})}(),this.WEBSDK||WEBSDKINIT(),function(){this.WEBSDK||WEBSDKINIT(),this.WEBSDK&&(this.WEBSDK.event.JsSip=new function(){return this.callAudio=function(e,t){let n=window.WEBSDK.event.rtcsdk.UA,o={};o=n.inCall()||n.hasSecondCall()?{code:"b0001",msg:"incall或hasSecondCall方法不存在，呼叫失败！"}:(n.call(e,"audio"),{code:"0",msg:"呼叫成功！"}),t&&t(o)},this.callVideo=function(e,t){let n=window.WEBSDK.event.rtcsdk.UA,o={};o=n.inCall()||n.hasSecondCall()?{code:"b0001",msg:"incall或hasSecondCall方法不存在，呼叫失败！"}:(n.call(e,"video",!1),{code:"0",msg:"呼叫成功！"}),t&&t(o)},this.callAnswer=function(e){let t=window.WEBSDK.event.rtcsdk.UA,n={};n=t.canAnswer()?(t.answer(!1),{code:"0",msg:"接听成功！"}):{code:"b0002",msg:"接听失败"},e&&e(n)},this.callSingleHangup=function(e){let t=window.WEBSDK.event.rtcsdk.UA,n={};n=t.inCall()?(t.hangup(),{code:"0",msg:"挂断成功！"}):{code:"b0003",msg:"呼叫不存在,挂断失败!"},e&&e(n)},this.callVoice=function(e){let t=window.WEBSDK.event.rtcsdk.UA,n={};if(!t.inCall())return n={code:"b0004",msg:"呼叫不存在，静音失败"},void(e&&e(n));var o=!t.getAudioStatus();n=o?{code:"0",msg:"取消静音成功！"}:{code:"0",msg:"静音成功！"},e&&e(n),t.switchAudio()},this.callHold=function(e){let t=window.WEBSDK.event.rtcsdk.UA,n={};if(!t.inCall())return n={code:"b0005",msg:"呼叫不存在，保持失败"},void(e&&e(n));n=t.isOnHold()?(t.unhold(),{code:"0",msg:"解除保持成功！"}):(t.hold(),{code:"0",msg:"保持成功！"}),e&&e(n)},this.callMeetHangup=function(e,t){let n=window.WEBSDK.event.rtcsdk.UA,o={};n.inCall()?(n.hangup(),window.WEBSDK.event.meet.stopMeeting({meetnum:e},function(e){o={code:"0",msg:"挂断成功！"},t&&t(o)})):(o={code:"b0003",msg:"呼叫不存在,挂断失败!"},t&&t(o))},this.switchVideo=function(e){let t=window.WEBSDK.event.rtcsdk.UA,n={};if(!t.inCall()||""===t.getVideoSource())return n={code:"b0005",msg:"呼叫不存在"},void(e&&e(n));var o=!t.getVideoStatus();n=o?{code:"0",msg:"视频已打开！"}:{code:"0",msg:"视频已关闭！"},t.switchVideo(),e&&e(n)},this.forceThreeway=function(e,t){var n="*3*"+e.phorex;let o=window.WEBSDK.event.rtcsdk.UA,a={};a=o.inCall()||o.hasSecondCall()?{code:"b0001",msg:"incall或hasSecondCall方法不存在，呼叫失败！"}:(e.video?o.call(n,"video",!1):o.call(n,"audio"),{code:"0",msg:"强插成功！"}),t&&t(a)},this.forceTransfer=function(e,t){var n="*2*"+e.phorex;let o=window.WEBSDK.event.rtcsdk.UA,a={};a=o.inCall()||o.hasSecondCall()?{code:"b0001",msg:"incall或hasSecondCall方法不存在，呼叫失败！"}:(e.video?o.call(n,"video",!1):o.call(n,"audio"),{code:"0",msg:"强拆成功！"}),t&&t(a)},this.eavesdrop=function(e,t){var n="*1*"+e.phorex;let o=window.WEBSDK.event.rtcsdk.UA,a={};a=o.inCall()||o.hasSecondCall()?{code:"b0001",msg:"incall或hasSecondCall方法不存在，呼叫失败！"}:(e.video?o.call(n,"video",!1):o.call(n,"audio"),{code:"0",msg:"监听成功！"}),t&&t(a)},this})}(),function(){this.WEBSDK||WEBSDKINIT(),this.WEBSDK&&(this.WEBSDK.event.socket.wsDataMethod=new function(){return this.extensionStatusNotice=function(n){n.targets&&0<n.targets.length&&window.WEBSDK.event.user.userList.forEach((t,e)=>{t.id==n.targets[0].id&&Object.keys(t).forEach(e=>{t[e]=n.targets[0][e]})}),n.users&&0<n.users.length&&window.WEBSDK.event.user.userList.forEach((t,e)=>{t.id==n.users[0].id&&Object.keys(t).forEach(e=>{t[e]=n.users[0][e]})})},this.guijiNotice=function({users:e=[],targets:t=[]}){let n=window.WEBSDK.event.user.userList;e.forEach(t=>{n.forEach(e=>{t.id,e.id})}),t.forEach(t=>{n.forEach(e=>{t.id,e.id})}),window.WEBSDK.event.user.setAllUser(n)},this.userOnMeetin=function(n,s){if(0!=Object.keys(window.WEBSDK.event.meet.meetInfo).length){let t=Object.assign({},window.WEBSDK.event.meet.meetInfo),o=t.meetMembers,a="";if(n.meetnum===t.meetnum){let e=n&&n.users?n.users:n&&n.user?[n.user]:[];return 0==n.type?e.forEach(n=>{n.comein=s||n.comein,a=`${n.name} ${s?"进入":"离开"}`,o.forEach(e=>{e.id==n.id&&Object.assign(e,n)}),n.comein||n.orgid||o.forEach((e,t)=>{e.id==n.id&&o.splice(t,1)})}):e.forEach(t=>{t.comein=s||t.comein,a=`${t.name} ${s?"进入":"离开"}`,o.forEach(e=>{e.id==t.id&&Object.assign(e,t)})}),t.meetMembers=o,window.WEBSDK.event.meet.setMeetInfo(t),a}}},this.meetoffMethod=function(e){e.meetnum==window.WEBSDK.event.meet.meetInfo.meetnum&&window.WEBSDK.event.meet.setMeetInfo({meetnum:"",meetMembers:[],type:null,state:!1,video:!1,radioFile:"beforePlay"})},this.meetaddMethod=function(e){var t=Object.assign({},window.WEBSDK.event.meet.meetInfo),n=t.meetMembers;e.meetnum===t.meetnum&&(e.users.forEach(t=>{n.push(t),n.forEach(e=>{e.id==t.id&&Object.assign(e,t)})}),t.meetMembers=n,window.WEBSDK.event.meet.setMeetInfo(t))},this.meetstateMethod=function(e,n){let t=Object.assign({},window.WEBSDK.event.meet.meetInfo),o=t.meetMembers,a="",s="",i="";if(e.meetnum===t.meetnum)return e.users.forEach(t=>{o.forEach(e=>{e.id==t.id&&(t.comein=e.comein,e=Object.assign(e,t),void 0!==n.speak&&(e.speak=n.speak),void 0!==n.deaf&&(e.deaf=n.deaf),void 0!==n.mute&&(e.mute=n.mute),void 0!==n.vmute&&(e.vmute=n.vmute),void 0!==n.vblind&&(e.vblind=n.vblind),a=e.name,s=e.phorex)})}),void 0!==n.speak&&(i=n.speak?a+"("+s+")正在讲话":""),t.meetMembers=o,window.WEBSDK.event.meet.setMeetInfo(t),i},this.meetdeleteMethod=function(e){var t=Object.assign({},window.WEBSDK.event.meet.meetInfo),o=t.meetMembers;e.meetnum===t.meetnum&&(e.users.forEach(n=>{o.forEach((e,t)=>{e.id==n.id&&o.splice(t,1)})}),t.meetMembers=o,window.WEBSDK.event.meet.setMeetInfo(t))},this.deleteMeetingUser=function(e){var t=Object.assign({},window.WEBSDK.event.meet.meetInfo),o=t.meetMembers;e.meetnum==t.meetnum&&(e.users.forEach(n=>{o.forEach((e,t)=>{e.id==n.id&&o.splice(t,1)})}),t.meetMembers=o,window.WEBSDK.event.meet.setMeetInfo(t))},this.channelHangupMethod=function(e){e.meetnum==window.WEBSDK.event.meet.meetInfo.meetnum&&window.WEBSDK.event.meet.setMeetInfo({meetnum:"",meetMembers:[],type:null,state:!1,video:!1,radioFile:"beforePlay"})},this.changeTaskStartMethod=function(e){e.meetnum==window.WEBSDK.event.meet.meetInfo.meetnum&&window.WEBSDK.event.meet.setMeetInfo({radioFile:"inPlay"})},this.changeTaskStopMethod=function(e){e.meetnum==window.WEBSDK.event.meet.meetInfo.meetnum&&window.WEBSDK.event.meet.setMeetInfo({radioFile:"afterPlay"})},this})}(),function(){this.WEBSDK||WEBSDKINIT(),this.WEBSDK&&(this.WEBSDK.event.user=new function(){let a={user:{url:"/dispatch/api?cmd=userinfo"},organizational:{url:"/dispatch/api?cmd=orginfo"}};return this.userList=[],this.getUserList=function(e,o){var t={seeall:window.WEBSDK.event.oneSelf?window.WEBSDK.event.oneSelf.seeall:""},t=Object.assign(t,e);window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+a.user.url,method:"post",data:t}).then(e=>{var t=e,a=[];let n={};n=0==t.res_code?(Object.keys(t.data).forEach(e=>{a.push(t.data[e])}),this.userList.length<=0||this.userList.length<a.length?this.userList=a:this.userList.forEach((n,o)=>{a.forEach((e,t)=>{n.id==e.id&&(this.userList[o]=e)})}),{data:a,code:"0",msg:"请求成功"}):{code:"a0001",msg:t.res_msg},o&&o(n)})},this.getAllUser=function(e){e&&e(this.userList)},this.setAllUser=function(e){this.userList=e},this.getOneSelf=function(e){e&&e(window.WEBSDK.event.oneSelf)},this.getOrgList=function(e,n){e=Object.assign({cascade:0},e);window.WEBSDK.ajax({url:window.WEBSDK.event.accountInfo.serviceUrl+a.organizational.url,method:"post",data:e}).then(e=>{let t={};t=0==e.res_code?{data:e.data,code:"0",msg:"请求成功"}:{code:"a0001",msg:e.res_msg},n&&n(t)})},this})}();